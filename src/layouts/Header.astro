<header class="headerPage" id="headerPage">
    
    <div class="logoContainer">
        <a href="http://delthac1.com" aria-label="Redireccion pagina de Delthac1">
            <img src="/logo_delthac1_plateado.png" alt="Logo Delthac1 Plateado" class="headerLogoDelthac" id="headerLogoDelthac">
        </a>
    </div>

    <div class="listRutasLocales" id="listRutasLocales">
        <ul class="nav-list" >
            <li class="nav-item">
                <a href="#Servicios" class="nav-link colorGold" id="navlink" aria-label="Redireccion seccion de pagina">
                    Servicios
                </a>
            </li>
            <li class="nav-item">
                <a href="#Nosotros" class="nav-link colorGold" id="navlink" aria-label="Redireccion seccion de pagina">
                    Nosotros
                </a>
            </li>
            <li class="nav-item">
                <a href="#Ubicaciones" class="nav-link colorGold" id="navlink" aria-label="Redireccion seccion de pagina">
                    Ubicaciones
                </a>
            </li>
            <li class="nav-item">
                <a href="#Contacto" class="nav-link colorGold" id="navlink" aria-label="Redireccion seccion de pagina">
                    Contacto
                </a>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link colorGold dropdown-toggle" id="navlink" aria-label="Menu desplegable de recursos">
                    Recursos
                    <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                    </svg>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="/documentos_pdf/pdfPruebas.pdf" target="_blank" class="dropdown-item colorGold">Documentos</a></li>
                    <li><a href="/documentos_pdf/pdfPruebas.pdf" target="_blank" class="dropdown-item colorGold">Formularios</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="btnsRedireccionContainer">
        <a href="https://www.mipagoamigo.com/MPA_WebSite/ServicePayments/StartPayment?id=12765&searchedCategoryId=&searchedAgreementName=DELTHAC%201%20SEGURIDAD%20LTDA%20BD" target="_blank" rel="noopener noreferrer" class="pseBtn" aria-label="Redireccion Mi Pago Amigo">
            <img src="/pse-logo.webp" alt="Logo pagos delthac por PSE" class="headerLogoPagosPSE">
        </a>

        <div class="">
            <a href="http://190.131.211.18:81/portal_externo/index.php" target="_blank" rel="noopener noreferrer" class="btn btn-primary btn-header-page" aria-label="Redireccion Portal de Empleados">Portal de Empleados</a>
        </div>
    </div>

    <div class="displayNav">
        <div class="displayNav-item colorWhite" id="displayNavItem">
            <svg xmlns="http://www.w3.org/2000/svg" width="35" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
            </svg>
        </div>
    </div>

</header>

<nav class="toggleNav nav-non-collapse" id="toggleNav">
    <section class="accesosRapidosContainer">
        <div class="accesoRapidoTitle">
            <h4 aria-label="Subtitulo Navegacion">ACCESOS RÁPIDOS</h4>
        </div>
        <div class="btnsRedireccionToggle">
            <div class="pseContainer">
                <a href="https://www.mipagoamigo.com/MPA_WebSite/ServicePayments/StartPayment?id=12765&searchedCategoryId=&searchedAgreementName=DELTHAC%201%20SEGURIDAD%20LTDA%20BD" target="_blank" rel="noopener noreferrer" class="">
                    <img src="/pse-logo.webp" alt="Logo pagos delthac por PSE" width="100" height="auto">
                </a>
            </div>
            <div class="portalEmpleadosContainer">
                <a href="http://190.131.211.18:81/portal_externo/index.php" target="_blank" rel="noopener noreferrer" class="btn btn-primary">Portal de Empleados</a>
            </div>
        </div>
    </section>
    <section class="listaMenuContainer">
        <div class="accesoRapidoTitle">
            <h4 aria-label="Subtitulo Navegacion">NAVEGACIÓN</h4>
        </div>
        <div class="menuContainer">
            <ul class="nav-list-toggle">
                <li class="nav-item">
                    <a href="#Servicios" class="nav-link" aria-label="Redireccion seccion de pagina">
                        Servicios
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#Nosotros" class="nav-link" aria-label="Redireccion seccion de pagina">
                        Nosotros
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#Ubicaciones" class="nav-link" aria-label="Redireccion seccion de pagina">
                        Ubicaciones
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#Contacto" class="nav-link" aria-label="Redireccion seccion de pagina">
                        Contacto
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" aria-label="Menu desplegable de recursos">
                        Recursos
                        <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                        </svg>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="/documentos_pdf/pdfPruebas.pdf" target="_blank" class="dropdown-item">Documentos</a></li>
                        <li><a href="/documentos_pdf/pdfPruebas.pdf" target="_blank" class="dropdown-item">Formularios</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </section>
</nav>


<script> 
    let flagDisplayNavBar = false;
    let toggleNav = document.getElementById('toggleNav') as HTMLDivElement;
    let displayNavItem = document.getElementById('displayNavItem') as HTMLDivElement;
    let objListRutasLocales = document.getElementById('listRutasLocales') as HTMLDivElement;
    let svgList = `
        <svg xmlns="http://www.w3.org/2000/svg" width="35" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
        </svg>
    `;
    let svgClose = `
        <svg xmlns="http://www.w3.org/2000/svg" width="35" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
        </svg>
    `;

    displayNavItem.addEventListener('click', async () => {
        //Definir el icono del nav
        flagDisplayNavBar = !flagDisplayNavBar;
        if(flagDisplayNavBar){
            displayNavItem.innerHTML = svgClose;
        }else{
            displayNavItem.innerHTML = svgList; //Icono por defecto
        }
        toggleNav.classList.toggle('nav-collapse');
    });

    // Función para cerrar el navbar lateral
    function closeSidebar() {
        if (flagDisplayNavBar) {
            flagDisplayNavBar = false;
            displayNavItem.innerHTML = svgList;
            toggleNav.classList.remove('nav-collapse');
        }
    }

    // Agregar event listeners a todos los enlaces de navegación del navbar lateral (excluyendo dropdowns)
    let objNavLinksToggle = document.querySelectorAll('.nav-list-toggle .nav-link:not(.dropdown-toggle)') as NodeListOf<HTMLAnchorElement>;
    objNavLinksToggle.forEach(link => {
        link.addEventListener('click', closeSidebar);
    });

    // También agregar event listeners a los enlaces de accesos rápidos
    let objAccesosRapidosLinks = document.querySelectorAll('.btnsRedireccionToggle a') as NodeListOf<HTMLAnchorElement>;
    objAccesosRapidosLinks.forEach(link => {
        link.addEventListener('click', closeSidebar);
    });

    // Agregar funcionalidad de toggle para el dropdown en móvil
    let objDropdownToggle = document.querySelector('.nav-list-toggle .dropdown-toggle') as HTMLAnchorElement;
    let objDropdown = document.querySelector('.nav-list-toggle .dropdown') as HTMLLIElement;
    
    if (objDropdownToggle && objDropdown) {
        objDropdownToggle.addEventListener('click', (e) => {
            e.preventDefault();
            objDropdown.classList.toggle('active');
        });
    }

    // Agregar funcionalidad de toggle para el dropdown en desktop
    let objDropdownToggleDesktop = document.querySelector('.nav-list .dropdown-toggle') as HTMLAnchorElement;
    let objDropdownDesktop = document.querySelector('.nav-list .dropdown') as HTMLLIElement;
    
    if (objDropdownToggleDesktop && objDropdownDesktop) {
        objDropdownToggleDesktop.addEventListener('click', (e) => {
            e.preventDefault();
            objDropdownDesktop.classList.toggle('active');
        });
    }

    // Los enlaces del menú desplegable NO cierran el sidebar
    // let objDropdownLinks = document.querySelectorAll('.dropdown-item') as NodeListOf<HTMLAnchorElement>;
    // objDropdownLinks.forEach(link => {
    //     link.addEventListener('click', closeSidebar);
    // });

    let objHeaderPage = document.getElementById('headerPage') as HTMLDivElement;
    let objNavLinks = document.querySelectorAll('.nav-link') as NodeListOf<HTMLAnchorElement>;
    let objHeaderLogoDelthac = document.getElementById('headerLogoDelthac') as HTMLImageElement;
    let vwInicial = window.innerHeight;
    let isVisible = false;
    
    // Función para manejar la visibilidad del botón con throttling
    function handleScroll() {
        const posicion = window.scrollY;
        const flagVisible = posicion > vwInicial;
        const flagOcultar = posicion < vwInicial - 50;
        
        // Buscar la sección CTA (que tiene fondo azul)
        const ctaSection = document.querySelector('.cta-section');
        const footerSection = document.querySelector('.footer');
        const objClsQuienesSomos = document.getElementById('clsQuienesSomos');
        let isOverBlueSection = false;
        let isOverFooter = false;
        let isOverClsQuienesSomos = false;
        
        if (ctaSection && footerSection && objClsQuienesSomos) {
            const ctaRect = ctaSection.getBoundingClientRect();
            const footerRect = footerSection.getBoundingClientRect();
            const clsQuienesSomosRect = objClsQuienesSomos.getBoundingClientRect();
            const headerHeight = 90; // altura del header
            isOverBlueSection = ctaRect.top <= headerHeight && ctaRect.bottom >= headerHeight;
            isOverFooter = footerRect.top <= headerHeight && footerRect.bottom >= headerHeight;
            isOverClsQuienesSomos = clsQuienesSomosRect.top <= headerHeight && clsQuienesSomosRect.bottom >= headerHeight;
        }
        
        //Si está sobre la sección azul, aplicar estilos especiales
        if (isOverBlueSection || isOverFooter || isOverClsQuienesSomos) {
            objHeaderPage?.classList.remove('headerBody');
            displayNavItem?.classList.remove('colorRed');
            objNavLinks.forEach(link => {
                link.classList.remove('blackText');
                link.classList.remove('colorRed');
            });
            objHeaderLogoDelthac.src = '/logo_delthac1_plateado.png';
        }else{
            objHeaderPage?.classList.add('headerBody');
            displayNavItem?.classList.add('colorRed');
            objNavLinks.forEach(link => {
                link.classList.add('blackText');
                link.classList.add('colorRed');
            });
            objHeaderLogoDelthac.src = '/logo_delthac1_red.png';
        }
    }
    
    // Throttling para mejorar el rendimiento del scroll
    let ticking = false;
    document.addEventListener('scroll', () => {
        if (!ticking) {
            requestAnimationFrame(() => {
                handleScroll();
                ticking = false;
            });
            ticking = true;
        }
    });
</script>